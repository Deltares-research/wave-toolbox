import numpy as np
import pytest

import deltares_wave_toolbox.cores.core_wavefunctions as core_wavefunctions


@pytest.mark.parametrize(
    ("f", "S", "Tps_exact"),
    (
        (0.5, 1, 2.0),
        ([1, 2], [1, 1], 1.0 / 1.5),
        ([1, 2], [1, 2], 0.5),
        ([1, 2], [2, 1], 1.0),
        ([0.5, 0.55, 0.61], [1, 0.5, 0.7], 2.0),
        ([0.35, 0.45, 0.5], [0.7, 0.5, 1], 2.0),
        ([0.35, 0.4, 0.6], [2, 1, 2], 1.0 / 0.35),
        ([0.35, 0.45, 0.5], [1, 1, 1], 1.0 / 0.45),
    ),
)
def test_compute_tps(f, S, Tps_exact):
    Tps_num = core_wavefunctions.compute_tps(f, S)
    assert Tps_num == Tps_exact


def test_create_spectrum_piersonmoskowitz():
    df = 0.005
    f = np.arange(0, 0.5 + df, df)
    Tp = 5
    fp = 1 / Tp
    hm0 = 1.5

    sVarDensCorrect = np.asarray(
        [
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0.0000,
            0.0000,
            0.0000,
            0.0000,
            0.0000,
            0.0000,
            0.0000,
            0.0000,
            0.0000,
            0.0000,
            0.0000,
            0.0000,
            0.0000,
            0.0001,
            0.0006,
            0.0029,
            0.0102,
            0.0276,
            0.0609,
            0.1147,
            0.1904,
            0.2852,
            0.3934,
            0.5075,
            0.6196,
            0.7230,
            0.8130,
            0.8863,
            0.9419,
            0.9797,
            1.0011,
            1.0078,
            1.0018,
            0.9855,
            0.9609,
            0.9300,
            0.8944,
            0.8557,
            0.8151,
            0.7736,
            0.7319,
            0.6907,
            0.6505,
            0.6116,
            0.5741,
            0.5384,
            0.5045,
            0.4724,
            0.4421,
            0.4136,
            0.3869,
            0.3619,
            0.3385,
            0.3166,
            0.2962,
            0.2772,
            0.2595,
            0.2430,
            0.2276,
            0.2133,
            0.2000,
            0.1876,
            0.1760,
            0.1653,
            0.1552,
            0.1459,
            0.1372,
            0.1291,
            0.1215,
            0.1144,
            0.1078,
            0.1017,
            0.0959,
            0.0905,
            0.0855,
            0.0808,
            0.0763,
            0.0722,
            0.0683,
            0.0647,
            0.0613,
            0.0581,
            0.0551,
            0.0523,
            0.0496,
            0.0471,
            0.0448,
            0.0425,
            0.0405,
            0.0385,
            0.0366,
            0.0349,
        ]
    )

    sVarDens = core_wavefunctions.create_spectrum_piersonmoskowitz(
        f, fp, hm0, output_object=False
    )

    assert sVarDens == pytest.approx(sVarDensCorrect, abs=1e-4)


def test_create_spectrum_jonswap():
    df = 0.005
    f = np.arange(0, 0.5 + df, df)
    Tp = 5
    fp = 1 / Tp
    hm0 = 1.5
    gammaPeak = 3.3

    sVarDensCorrect = [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0.0000,
        0.0000,
        0.0000,
        0.0000,
        0.0000,
        0.0000,
        0.0000,
        0.0000,
        0.0000,
        0.0000,
        0.0000,
        0.0000,
        0.0000,
        0.0001,
        0.0004,
        0.0019,
        0.0067,
        0.0181,
        0.0399,
        0.0752,
        0.1249,
        0.1874,
        0.2597,
        0.3395,
        0.4281,
        0.5346,
        0.6792,
        0.8936,
        1.2098,
        1.6201,
        2.0120,
        2.1804,
        2.0718,
        1.7976,
        1.4647,
        1.1610,
        0.9244,
        0.7556,
        0.6400,
        0.5612,
        0.5057,
        0.4644,
        0.4313,
        0.4028,
        0.3771,
        0.3532,
        0.3308,
        0.3097,
        0.2898,
        0.2712,
        0.2537,
        0.2372,
        0.2219,
        0.2076,
        0.1942,
        0.1817,
        0.1701,
        0.1593,
        0.1492,
        0.1398,
        0.1311,
        0.1230,
        0.1154,
        0.1083,
        0.1018,
        0.0957,
        0.0899,
        0.0846,
        0.0797,
        0.0750,
        0.0707,
        0.0667,
        0.0629,
        0.0593,
        0.0560,
        0.0530,
        0.0501,
        0.0473,
        0.0448,
        0.0424,
        0.0402,
        0.0381,
        0.0361,
        0.0343,
        0.0325,
        0.0309,
        0.0293,
        0.0279,
        0.0265,
        0.0252,
        0.0240,
        0.0229,
    ]

    sVarDens = core_wavefunctions.create_spectrum_jonswap(
        f, fp, hm0, gammaPeak, output_object=False
    )

    assert sVarDens == pytest.approx(sVarDensCorrect, abs=1e-4)
